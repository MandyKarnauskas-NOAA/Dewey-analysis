# Install libraries ------------------------------------
if ("vegan" %in% available.packages() == FALSE) { install.packages("vegan") }
if ("viridis" %in% available.packages() == FALSE) { install.packages("viridis") }
library(vegan)
library(MASS)
library(viridis)
library(yarrr)
# Load data --------------------------------------------
dfl <- read.table("Charter_SouthFloridaKeys_9_10_20_906Count.csv",
header = T, sep = ",", check.names = F, quote = "")
dnc <- read.table("Charter__NCVA_9_10_20_1340Count.csv",
header = T, sep = ",", check.names = F, quote = "")
head(dfl)
head(dnc)
#########################################################
#  M. Karnauskas - 30 June 2020                         #
#  Code for running the "Dewey analysis"                #
#  Processing of charter boat social media              #
#  NMDS and ANOSIM code                                 #
#########################################################
# Set directory ----------------------------------------
rm(list=ls())
setwd("C:/Users/mandy.karnauskas/Desktop/participatory_workshops/Dewey_analysis")
# Install libraries ------------------------------------
if ("vegan" %in% available.packages() == FALSE) { install.packages("vegan") }
if ("viridis" %in% available.packages() == FALSE) { install.packages("viridis") }
library(vegan)
library(MASS)
library(viridis)
library(yarrr)
# Load data --------------------------------------------
dfl <- read.table("Charter_SouthFloridaKeys_9_10_20_906Count.csv",
header = T, sep = ",", check.names = F, quote = "")
dnc <- read.table("Charter__NCVA_9_10_20_1340Count.csv",
header = T, sep = ",", check.names = F, quote = "")
#d <- dfl
#d <- dnc
# ONLY for analysis of two regions together ------------
dfl[is.na(dfl)] <- 0
dnc[is.na(dnc)] <- 0
head(dfl)
head(dnc)
names(dnc)[which(names(dnc) %in% names(dfl))]
names(dnc)[-which(names(dnc) %in% names(dfl))]
# modify names so that they match
names(dfl)[grep("Tilefish", names(dfl))] <- "Tilefish"
names(dfl)[grep("Spanish", names(dfl))] <- "Spanish_Mackerel"
dnc$tunas <- dnc$Tuna_Complex
dfl$tunas <- dfl$Blackfin_Tuna + dfl$Skipjack_Tuna      # lump tunas
dfl$groupers <- rowSums(dfl[,grep("Grouper", names(dfl))], na.rm = T)
dnc$groupers <- dnc$Grouper_Complex + dnc$Black_Sea_Bass  # lump groupers
names(dnc)[which(names(dnc) %in% names(dfl))]     # check names
names(dnc)[-which(names(dnc) %in% names(dfl))]
dnc <- dnc[which(names(dnc) %in% names(dfl))]
names(dnc)[-which(names(dnc) %in% names(dfl))]
dfl <- dfl[,-grep("Tuna", names(dfl))]  # remove lumped columns
dfl <- dfl[,-grep("Grouper", names(dfl))]
dfl <- dfl[,-grep("Notes", names(dfl))]  # remove notes column
dnc <- dnc[,-grep("Notes", names(dnc))]
match(names(dnc), names(dfl))
dfl2 <- dfl[match(names(dnc), names(dfl))]  # sort columns in NC to match FL
head(dfl2)
cbind(names(dfl2), names(dnc))
table(names(dfl2) == names(dnc))
d <- rbind(dfl2, dnc)        # combine into single data frame
head(D)
head(d)
# assign other variables ------------------------------------
names(d)
head(dfl2)
head(dfl)
dim(dfl)
dim(dfl)*.1
dim(dfl)*.05
runif(40, 1, 905)
runif(40, min = 1, max = 905)
round(runif(40, min = 1, max = 905))
dfl[round(runif(40, min = 1, max = 905)),]
dim(dnc)
1339*.05
1339*.04
dfl_check <- dfl[round(runif(40, min = 1, max = 905)),]
dnc_check <- dnc[round(runif(50, min = 1, max = 905)),]
dlf_che
dlf_check
dfl_check
write.table(dfl_check, file = "checkFL.csv", sep = ",", row.names = F)
dfl_check <- dfl[round(runif(40, min = 1, max = 905)),]
dnc_check <- dnc[round(runif(50, min = 1, max = 1330)),]
write.table(dfl_check, file = "checkFL.csv", sep = ",", row.names = F)
write.table(dnc_check, file = "checkNC.csv", sep = ",", row.names = F)
getwd()
nrow(dnc)
50 / 1339
40 / 905
nrow(dnc)
nrow(dfl)
905 + 1339
2244 * 0.05
112 - 90
nrow(dnc) + nrow(dfl)
(nrow(dnc) + nrow(dfl)) * 0.05
(nrow(dnc) + nrow(dfl)) * 0.05 = 90
(nrow(dnc) + nrow(dfl)) * 0.05 - 90
#########################################################
#  M. Karnauskas - 30 June 2020                         #
#  Code for running the "Dewey analysis"                #
#  Processing of charter boat social media              #
#  NMDS and ANOSIM code                                 #
#########################################################
# Set directory ----------------------------------------
rm(list=ls())
setwd("C:/Users/mandy.karnauskas/Desktop/participatory_workshops/Dewey_analysis")
# Install libraries ------------------------------------
if ("vegan" %in% available.packages() == FALSE) { install.packages("vegan") }
if ("viridis" %in% available.packages() == FALSE) { install.packages("viridis") }
library(vegan)
library(MASS)
library(viridis)
library(yarrr)
# Load data --------------------------------------------
dfl <- read.table("Charter_SouthFloridaKeys_9_10_20_906Count.csv",
header = T, sep = ",", check.names = F, quote = "")
dnc <- read.table("Charter__NCVA_9_10_20_1340Count.csv",
header = T, sep = ",", check.names = F, quote = "")
#d <- dfl
#d <- dnc
# ONLY for analysis of two regions together ------------
dfl[is.na(dfl)] <- 0
dnc[is.na(dnc)] <- 0
head(dfl)
head(dnc)
names(dnc)[which(names(dnc) %in% names(dfl))]
names(dnc)[-which(names(dnc) %in% names(dfl))]
# modify names so that they match
names(dfl)[grep("Tilefish", names(dfl))] <- "Tilefish"
names(dfl)[grep("Spanish", names(dfl))] <- "Spanish_Mackerel"
dnc$tunas <- dnc$Tuna_Complex
dfl$tunas <- dfl$Blackfin_Tuna + dfl$Skipjack_Tuna      # lump tunas
dfl$groupers <- rowSums(dfl[,grep("Grouper", names(dfl))], na.rm = T)
dnc$groupers <- dnc$Grouper_Complex + dnc$Black_Sea_Bass  # lump groupers
names(dnc)[which(names(dnc) %in% names(dfl))]     # check names
names(dnc)[-which(names(dnc) %in% names(dfl))]
dnc <- dnc[which(names(dnc) %in% names(dfl))]
names(dnc)[-which(names(dnc) %in% names(dfl))]
dfl <- dfl[,-grep("Tuna", names(dfl))]  # remove lumped columns
dfl <- dfl[,-grep("Grouper", names(dfl))]
dfl <- dfl[,-grep("Notes", names(dfl))]  # remove notes column
dnc <- dnc[,-grep("Notes", names(dnc))]
match(names(dnc), names(dfl))
dfl2 <- dfl[match(names(dnc), names(dfl))]  # sort columns in NC to match FL
head(dfl2)
cbind(names(dfl2), names(dnc))
table(names(dfl2) == names(dnc))
d <- rbind(dfl2, dnc)        # combine into single data frame
905 * 0.05
nrow(dnc) * 0.05
67
67 - 50
# output files for QAQC check
dfl_check <- dfl[round(runif(45, min = 1, max = 905)),]
dnc_check <- dnc[round(runif(17, min = 1, max = 1330)),]
write.table(dfl_check, file = "checkFL.csv", sep = ",", row.names = F)
write.table(dnc_check, file = "checkNC.csv", sep = ",", row.names = F, append = T)
rm(list=ls())
url <- "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"
d <- read.delim(url, header = T, sep = ",")
d1 <- d[which(d$fips==12086),] # miami
d2 <- d[which(d$fips==17097),] # lake
d3 <- d[which(d$fips==55133),] # waukesha
plot(d1$date, d1$cases)
points(d2$date, d2$cases, col=2)
points(d3$date, d3$cases, col=3)
d1$newcases <- c(0, d1$cases[2:nrow(d1)] - d1$cases[1:(nrow(d1)-1)])
d1$newcasegrwth <- c(0, d1$newcases[2:nrow(d1)] - d1$newcases[1:(nrow(d1)-1)])
MoveAve <- function(x, width) {
as.vector(filter(x, rep(1/width, width), sides=2)) }
diff(as.Date(d1$date))
mean(diff(as.Date(d1$date)))
d1$dat2 <- format(as.Date(d1$date), "%b %d")
d1$doy <- 1:nrow(d1)
d1$drate <- d1$deaths / d1$cases * 10000
yl <- MoveAve(d1$newcases, 7)
yl[2:120]- yl[1:119]
plot(yl[2:120]- yl[1:119])
plot(d1$doy[2:120], (yl[2:120]- yl[1:119]), type="l")
abline(h=0)
# -- plot ------------------------------------------------------------
par(mar=c(6,5,3,5))
plot(d1$doy, d1$newcases, axes=F, las=2, ylab="new cases per day", xlab="",
pch=20, ylim=c(0,4200),
main="Analysis of NY Times COVID database for Miami-Dade County")
lines(d1$doy, d1$newcases)
axis(1, at=d1$doy, lab=d1$dat2, las=2)
axis(2, las=2); box()
mtext(side=4, "death rate (%)", line=2)
p <- 1500
v1 <- which(d1$dat2=="Mar 24")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7, p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "Miami\nshelter-\nin-place\norder",
col=gray(0.4), pos=2)
#v1 <- which(d1$dat2=="Apr 17")
#text(v1, 50, "LIBERATE\ntweets", col=gray(0.4), pos=2)
#abline(v=v1, col=8, lwd=3)
#v1 <- which(d1$dat2=="May 03")
#abline(v=v1, col=8, lwd=3)
#abline(v=v1+6, col=8, lwd=3)
#arrows(v1, 550, v1+6, 550, length=0.1, col=gray(0.4))
#arrows(v1+6.5, 550, v1, 550, length=0.1, col=gray(0.4))
#text(v1, 550, "Protesters gather in Miami,\ndeclare stay-at-home \norders are 'tyranny'", col=gray(0.4), pos=2)
#text(v1+3, 600, "6 days\n(average\nincubation\nperiod)", col=gray(0.4), cex=0.8)
v1 <- which(d1$dat2=="Jun 01")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7,p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "Miami \nreopens \n businesses", col=gray(0.4), pos=2)
p <- p + 2600
v1 <- which(d1$dat2=="Jul 07")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7,p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "\n\n\nEmergency\nOrder 26-20\n(close indoor\nfacilities)", col=gray(0.4), pos=2)
#v1 <- which(d1$dat2=="Jul 07")
#abline(v=v1, col=8, lwd=3, lty=3)
#text(v1, p, "\n\n\n\nEmergency\nOrder 26-20\n(close indoor\ndining)", col=gray(0.4), pos=4)
lines(d1$doy, yl, col=2, lwd=3)
lines(d1$doy, d1$drate*10, col=4, lwd=2)
axis(4, at=seq(0,4000,1000), lab=seq(0,4,1), las=2)
legend("topleft", bg="white", c("new cases per day", "7-day moving average", "death rate"), col=c(1,2,4), lwd=c(1,3,2), pch=20, pt.cex = c(1,0,0))
tail(d1)
abline(h=300)
rm(list=ls())
url <- "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"
d <- read.delim(url, header = T, sep = ",")
d1 <- d[which(d$fips==12086),] # miami
d2 <- d[which(d$fips==17097),] # lake
d3 <- d[which(d$fips==55133),] # waukesha
plot(d1$date, d1$cases)
points(d2$date, d2$cases, col=2)
points(d3$date, d3$cases, col=3)
d1$newcases <- c(0, d1$cases[2:nrow(d1)] - d1$cases[1:(nrow(d1)-1)])
d1$newcasegrwth <- c(0, d1$newcases[2:nrow(d1)] - d1$newcases[1:(nrow(d1)-1)])
MoveAve <- function(x, width) {
as.vector(filter(x, rep(1/width, width), sides=2)) }
diff(as.Date(d1$date))
mean(diff(as.Date(d1$date)))
d1$dat2 <- format(as.Date(d1$date), "%b %d")
d1$doy <- 1:nrow(d1)
d1$drate <- d1$deaths / d1$cases * 10000
yl <- MoveAve(d1$newcases, 7)
yl[2:120]- yl[1:119]
plot(yl[2:120]- yl[1:119])
plot(d1$doy[2:120], (yl[2:120]- yl[1:119]), type="l")
abline(h=0)
# -- plot ------------------------------------------------------------
par(mar=c(6,5,3,5))
plot(d1$doy, d1$newcases, axes=F, las=2, ylab="new cases per day", xlab="",
pch=20, ylim=c(0,4200),
main="Analysis of NY Times COVID database for Miami-Dade County")
lines(d1$doy, d1$newcases)
axis(1, at=d1$doy, lab=d1$dat2, las=2)
axis(2, las=2); box()
mtext(side=4, "death rate (%)", line=2)
p <- 1500
v1 <- which(d1$dat2=="Mar 24")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7, p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "Miami\nshelter-\nin-place\norder",
col=gray(0.4), pos=2)
#v1 <- which(d1$dat2=="Apr 17")
#text(v1, 50, "LIBERATE\ntweets", col=gray(0.4), pos=2)
#abline(v=v1, col=8, lwd=3)
#v1 <- which(d1$dat2=="May 03")
#abline(v=v1, col=8, lwd=3)
#abline(v=v1+6, col=8, lwd=3)
#arrows(v1, 550, v1+6, 550, length=0.1, col=gray(0.4))
#arrows(v1+6.5, 550, v1, 550, length=0.1, col=gray(0.4))
#text(v1, 550, "Protesters gather in Miami,\ndeclare stay-at-home \norders are 'tyranny'", col=gray(0.4), pos=2)
#text(v1+3, 600, "6 days\n(average\nincubation\nperiod)", col=gray(0.4), cex=0.8)
v1 <- which(d1$dat2=="Jun 01")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7,p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "Miami \nreopens \n businesses", col=gray(0.4), pos=2)
p <- p + 2600
v1 <- which(d1$dat2=="Jul 07")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7,p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "\n\n\nEmergency\nOrder 26-20\n(close indoor\nfacilities)", col=gray(0.4), pos=2)
#v1 <- which(d1$dat2=="Jul 07")
#abline(v=v1, col=8, lwd=3, lty=3)
#text(v1, p, "\n\n\n\nEmergency\nOrder 26-20\n(close indoor\ndining)", col=gray(0.4), pos=4)
lines(d1$doy, yl, col=2, lwd=3)
lines(d1$doy, d1$drate*10, col=4, lwd=2)
axis(4, at=seq(0,4000,1000), lab=seq(0,4,1), las=2)
legend("topleft", bg="white", c("new cases per day", "7-day moving average", "death rate"), col=c(1,2,4), lwd=c(1,3,2), pch=20, pt.cex = c(1,0,0))
tail(d1)
abline(h=300)
rm(list=ls())
url <- "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"
d <- read.delim(url, header = T, sep = ",")
# Set directory ----------------------------------------
rm(list=ls())
setwd("C:/Users/mandy.karnauskas/Desktop/participatory_workshops/Dewey_analysis")
# Install libraries ------------------------------------
if ("vegan" %in% available.packages() == FALSE) { install.packages("vegan") }
if ("viridis" %in% available.packages() == FALSE) { install.packages("viridis") }
library(vegan)
library(MASS)
library(viridis)
library(yarrr)
# Load data --------------------------------------------
dfl <- read.table("Charter_SouthFloridaKeys_9_10_20_906Count.csv",
header = T, sep = ",", check.names = F, quote = "")
dnc <- read.table("Charter__NCVA_9_10_20_1340Count.csv",
header = T, sep = ",", check.names = F, quote = "")
dfl[is.na(dfl)] <- 0
dnc[is.na(dnc)] <- 0
head(dfl)
head(dnc)
names(dnc)[which(names(dnc) %in% names(dfl))]
names(dnc)[-which(names(dnc) %in% names(dfl))]
# modify names so that they match
names(dfl)[grep("Tilefish", names(dfl))] <- "Tilefish"
rowSums(dnc[9:ncol(dnc)])
rowSums(dnc[9:ncol(dnc)]) == 0
which(rowSums(dnc[9:ncol(dnc)]) == 0)
d[34,]
dnc[34]
dnc[34,]
dnc[1027,]
dnc[1028,]
dnc[1029,]
dnc[1030,]
dnc[1031,]
dnc[1032,]
dnc[1033,]
dnc[1034,]
dnc[1047,]
nrow(dnc)
nrow(dfl)
1339+905
112/2244
113/2244
1/112
111/112
rm(list=ls())
url <- "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"
d <- read.delim(url, header = T, sep = ",")
d1 <- d[which(d$fips==12086),] # miami
d2 <- d[which(d$fips==17097),] # lake
d3 <- d[which(d$fips==55133),] # waukesha
plot(d1$date, d1$cases)
points(d2$date, d2$cases, col=2)
points(d3$date, d3$cases, col=3)
d1$newcases <- c(0, d1$cases[2:nrow(d1)] - d1$cases[1:(nrow(d1)-1)])
d1$newcasegrwth <- c(0, d1$newcases[2:nrow(d1)] - d1$newcases[1:(nrow(d1)-1)])
MoveAve <- function(x, width) {
as.vector(filter(x, rep(1/width, width), sides=2)) }
diff(as.Date(d1$date))
mean(diff(as.Date(d1$date)))
d1$dat2 <- format(as.Date(d1$date), "%b %d")
d1$doy <- 1:nrow(d1)
d1$drate <- d1$deaths / d1$cases * 10000
yl <- MoveAve(d1$newcases, 7)
yl[2:120]- yl[1:119]
plot(yl[2:120]- yl[1:119])
plot(d1$doy[2:120], (yl[2:120]- yl[1:119]), type="l")
abline(h=0)
# -- plot ------------------------------------------------------------
par(mar=c(6,5,3,5))
plot(d1$doy, d1$newcases, axes=F, las=2, ylab="new cases per day", xlab="",
pch=20, ylim=c(0,4200),
main="Analysis of NY Times COVID database for Miami-Dade County")
lines(d1$doy, d1$newcases)
axis(1, at=d1$doy, lab=d1$dat2, las=2)
axis(2, las=2); box()
mtext(side=4, "death rate (%)", line=2)
p <- 1500
v1 <- which(d1$dat2=="Mar 24")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7, p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "Miami\nshelter-\nin-place\norder",
col=gray(0.4), pos=2)
#v1 <- which(d1$dat2=="Apr 17")
#text(v1, 50, "LIBERATE\ntweets", col=gray(0.4), pos=2)
#abline(v=v1, col=8, lwd=3)
#v1 <- which(d1$dat2=="May 03")
#abline(v=v1, col=8, lwd=3)
#abline(v=v1+6, col=8, lwd=3)
#arrows(v1, 550, v1+6, 550, length=0.1, col=gray(0.4))
#arrows(v1+6.5, 550, v1, 550, length=0.1, col=gray(0.4))
#text(v1, 550, "Protesters gather in Miami,\ndeclare stay-at-home \norders are 'tyranny'", col=gray(0.4), pos=2)
#text(v1+3, 600, "6 days\n(average\nincubation\nperiod)", col=gray(0.4), cex=0.8)
v1 <- which(d1$dat2=="Jun 01")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7,p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "Miami \nreopens \n businesses", col=gray(0.4), pos=2)
p <- p + 2600
v1 <- which(d1$dat2=="Jul 07")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7,p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "\n\n\nEmergency\nOrder 26-20\n(close indoor\nfacilities)", col=gray(0.4), pos=2)
#v1 <- which(d1$dat2=="Jul 07")
#abline(v=v1, col=8, lwd=3, lty=3)
#text(v1, p, "\n\n\n\nEmergency\nOrder 26-20\n(close indoor\ndining)", col=gray(0.4), pos=4)
lines(d1$doy, yl, col=2, lwd=3)
lines(d1$doy, d1$drate*10, col=4, lwd=2)
axis(4, at=seq(0,4000,1000), lab=seq(0,4,1), las=2)
legend("topleft", bg="white", c("new cases per day", "7-day moving average", "death rate"), col=c(1,2,4), lwd=c(1,3,2), pch=20, pt.cex = c(1,0,0))
tail(d1)
abline(h=300)
rm(list=ls())
url <- "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"
d <- read.delim(url, header = T, sep = ",")
d1 <- d[which(d$fips==12086),] # miami
d2 <- d[which(d$fips==17097),] # lake
d3 <- d[which(d$fips==55133),] # waukesha
plot(d1$date, d1$cases)
points(d2$date, d2$cases, col=2)
points(d3$date, d3$cases, col=3)
d1$newcases <- c(0, d1$cases[2:nrow(d1)] - d1$cases[1:(nrow(d1)-1)])
d1$newcasegrwth <- c(0, d1$newcases[2:nrow(d1)] - d1$newcases[1:(nrow(d1)-1)])
MoveAve <- function(x, width) {
as.vector(filter(x, rep(1/width, width), sides=2)) }
diff(as.Date(d1$date))
mean(diff(as.Date(d1$date)))
d1$dat2 <- format(as.Date(d1$date), "%b %d")
d1$doy <- 1:nrow(d1)
d1$drate <- d1$deaths / d1$cases * 10000
yl <- MoveAve(d1$newcases, 7)
yl[2:120]- yl[1:119]
plot(yl[2:120]- yl[1:119])
plot(d1$doy[2:120], (yl[2:120]- yl[1:119]), type="l")
abline(h=0)
# -- plot ------------------------------------------------------------
par(mar=c(6,5,3,5))
plot(d1$doy, d1$newcases, axes=F, las=2, ylab="new cases per day", xlab="",
pch=20, ylim=c(0,4200),
main="Analysis of NY Times COVID database for Miami-Dade County")
lines(d1$doy, d1$newcases)
axis(1, at=d1$doy, lab=d1$dat2, las=2)
axis(2, las=2); box()
mtext(side=4, "death rate (%)", line=2)
p <- 1500
v1 <- which(d1$dat2=="Mar 24")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7, p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "Miami\nshelter-\nin-place\norder",
col=gray(0.4), pos=2)
#v1 <- which(d1$dat2=="Apr 17")
#text(v1, 50, "LIBERATE\ntweets", col=gray(0.4), pos=2)
#abline(v=v1, col=8, lwd=3)
#v1 <- which(d1$dat2=="May 03")
#abline(v=v1, col=8, lwd=3)
#abline(v=v1+6, col=8, lwd=3)
#arrows(v1, 550, v1+6, 550, length=0.1, col=gray(0.4))
#arrows(v1+6.5, 550, v1, 550, length=0.1, col=gray(0.4))
#text(v1, 550, "Protesters gather in Miami,\ndeclare stay-at-home \norders are 'tyranny'", col=gray(0.4), pos=2)
#text(v1+3, 600, "6 days\n(average\nincubation\nperiod)", col=gray(0.4), cex=0.8)
v1 <- which(d1$dat2=="Jun 01")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7,p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "Miami \nreopens \n businesses", col=gray(0.4), pos=2)
p <- p + 2600
v1 <- which(d1$dat2=="Jul 07")
abline(v=v1, col=8, lwd=3)
abline(v=v1+14, col=gray(0.8), lwd=3)
arrows(v1, p-300, v1+14, p-300, length=0.1, col=gray(0.4))
arrows(v1+14, p-300, v1, p-300, length=0.1, col=gray(0.4))
text(v1+7,p, "14 days\n(incubation\nperiod)", col=gray(0.4), cex=0.8)
text(v1, p, "\n\n\nEmergency\nOrder 26-20\n(close indoor\nfacilities)", col=gray(0.4), pos=2)
#v1 <- which(d1$dat2=="Jul 07")
#abline(v=v1, col=8, lwd=3, lty=3)
#text(v1, p, "\n\n\n\nEmergency\nOrder 26-20\n(close indoor\ndining)", col=gray(0.4), pos=4)
lines(d1$doy, yl, col=2, lwd=3)
lines(d1$doy, d1$drate*10, col=4, lwd=2)
axis(4, at=seq(0,4000,1000), lab=seq(0,4,1), las=2)
legend("topleft", bg="white", c("new cases per day", "7-day moving average", "death rate"), col=c(1,2,4), lwd=c(1,3,2), pch=20, pt.cex = c(1,0,0))
tail(d1)
abline(h=300)
